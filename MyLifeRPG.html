<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Interface - Player One</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Import Fonts: Orbitron (Sci-Fi/System look) & Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Orbitron:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

        /* --- SOLO LEVELING THEME VARIABLES --- */
        :root {
            --system-blue: #00eaff;
            --system-blue-dim: rgba(0, 234, 255, 0.1);
            --system-glow: 0 0 10px rgba(0, 234, 255, 0.6);
            --shadow-purple: #9d4edd;
            --bg-dark: #050505;
            --bg-panel: #0a0a0a;
            --border-color: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #e2e8f0;
            background-image: radial-gradient(circle at 50% 50%, #111827 0%, #000000 100%);
        }

        h1, h2, h3, .font-system {
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* --- CUSTOM SCROLLBAR (System Style) --- */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #000;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border: 1px solid #334155;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--system-blue);
            box-shadow: 0 0 5px var(--system-blue);
        }

        /* --- UI COMPONENTS (The System Look) --- */
        
        /* Glowing Blue Text */
        .text-glow {
            color: var(--system-blue);
            text-shadow: 0 0 8px rgba(0, 234, 255, 0.5);
        }

        /* System Panels */
        .system-panel {
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        /* Active Tab / Button */
        .btn-system-active {
            background: linear-gradient(90deg, rgba(0, 234, 255, 0.1) 0%, transparent 100%);
            border-left: 3px solid var(--system-blue);
            color: var(--system-blue);
            text-shadow: 0 0 5px rgba(0, 234, 255, 0.4);
        }

        /* Card Styles */
        .quest-card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .quest-card:hover {
            border-color: var(--system-blue);
            box-shadow: inset 0 0 20px rgba(0, 234, 255, 0.05);
            transform: translateY(-2px);
        }

        /* Tiers Colors (Solo Leveling Ranks) */
        /* E-Rank/D-Rank (Easy) - White/Grey */
        .tier-c { border-top: 3px solid #94a3b8; } 
        /* C-Rank/B-Rank (Medium) - Blue */
        .tier-b { border-top: 3px solid #00eaff; box-shadow: 0 -5px 15px -5px rgba(0, 234, 255, 0.2); }
        /* A-Rank (Hard) - Red/Orange (Dangerous) */
        .tier-a { border-top: 3px solid #ef4444; box-shadow: 0 -5px 15px -5px rgba(239, 68, 68, 0.2); }
        /* S-Rank (Epic) - Purple (Shadow Monarch) or Gold */
        .tier-s { border-top: 3px solid #9d4edd; box-shadow: 0 -5px 15px -5px rgba(157, 78, 221, 0.3); }

        /* --- ANIMATIONS --- */
        @keyframes system-pulse {
            0% { box-shadow: 0 0 5px var(--system-blue-dim); }
            50% { box-shadow: 0 0 15px rgba(0, 234, 255, 0.3); }
            100% { box-shadow: 0 0 5px var(--system-blue-dim); }
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .level-up-anim {
            animation: system-pulse 2s infinite;
        }

        .damage-anim {
            animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
            border: 1px solid #ef4444;
            color: #ef4444;
        }

        /* Progress Bar Gradient */
        .system-progress {
            background: linear-gradient(90deg, #005f73, #0a9396, #00eaff);
            box-shadow: 0 0 10px #00eaff;
        }

        /* HP Bar */
        .hp-progress {
            background: linear-gradient(90deg, #991b1b, #ef4444);
            box-shadow: 0 0 10px #ef4444;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }
        
        /* Avatar Upload Overlay */
        .avatar-overlay {
            background: rgba(0,0,0,0.6);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .avatar-container:hover .avatar-overlay {
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- HIDDEN AVATAR INPUT -->
    <input type="file" id="avatar-upload" accept="image/*" class="hidden" onchange="handleAvatarUpload(this)">

    <!-- SIDEBAR / MOBILE NAV -->
    <nav class="bg-[#0a0a0a] w-full md:w-72 flex-shrink-0 border-b md:border-b-0 md:border-r border-[#333] flex flex-col justify-between z-20 shadow-[5px_0_20px_rgba(0,0,0,0.5)]">
        <div class="p-8 border-b border-[#222]">
            <h1 class="text-3xl font-bold text-white tracking-wider flex items-center gap-3" style="text-shadow: 0 0 10px rgba(255,255,255,0.3);">
                <span class="text-blue-500 animate-pulse">‚ùñ</span> SYSTEM
            </h1>
            <p class="text-[10px] text-blue-400 mt-2 font-mono uppercase tracking-[0.2em]">Player Authorization Required</p>
        </div>

        <div class="flex-1 overflow-y-auto py-6 px-4 space-y-3">
            <button onclick="switchTab('quests')" id="nav-quests" class="w-full text-left px-6 py-4 rounded-sm font-system font-bold text-sm transition flex items-center gap-4 border-l-2 border-transparent hover:bg-[#111] group">
                <i class="fa-solid fa-exclamation group-hover:text-blue-400 transition"></i> QUESTS
            </button>
            <button onclick="switchTab('shop')" id="nav-shop" class="w-full text-left px-6 py-4 rounded-sm text-slate-400 hover:bg-[#111] font-system font-bold text-sm transition flex items-center gap-4 border-l-2 border-transparent group">
                <i class="fa-solid fa-cart-shopping group-hover:text-blue-400 transition"></i> STORE
            </button>
            <button onclick="switchTab('profile')" id="nav-profile" class="w-full text-left px-6 py-4 rounded-sm text-slate-400 hover:bg-[#111] font-system font-bold text-sm transition flex items-center gap-4 border-l-2 border-transparent group">
                <i class="fa-solid fa-user group-hover:text-blue-400 transition"></i> STATUS
            </button>
            <button onclick="switchTab('settings')" id="nav-settings" class="w-full text-left px-6 py-4 rounded-sm text-slate-400 hover:bg-[#111] font-system font-bold text-sm transition flex items-center gap-4 border-l-2 border-transparent group">
                <i class="fa-solid fa-database group-hover:text-blue-400 transition"></i> SYSTEM DATA
            </button>
        </div>

        <div class="p-6 border-t border-[#222]">
            <div class="bg-black/50 rounded p-4 border border-[#333]">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-[10px] text-slate-500 font-mono tracking-widest">HP (FATIGUE)</span>
                    <span id="hp-text" class="text-sm font-bold text-red-500 font-mono">100/100</span>
                </div>
                <div class="w-full bg-[#222] h-1.5 mb-4 overflow-hidden">
                    <div id="hp-bar" class="hp-progress h-full transition-all duration-500" style="width: 100%"></div>
                </div>
                
                <button onclick="takeDamage()" class="w-full py-2 text-[10px] font-mono uppercase tracking-widest text-red-500 border border-red-900/50 hover:bg-red-900/20 transition">
                    Penalty Zone (-10 HP)
                </button>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        
        <!-- TOP HEADER (STATS) -->
        <header class="bg-[#050505]/90 backdrop-blur border-b border-[#222] p-6 flex flex-col md:flex-row justify-between items-center shadow-lg z-10 gap-4">
            <div class="flex items-center gap-6 w-full md:w-auto">
                <div class="relative group">
                    <div class="w-16 h-16 flex items-center justify-center relative z-10 bg-black border-2 border-blue-500 shadow-[0_0_15px_rgba(0,234,255,0.3)] rounded-sm transform rotate-45 group-hover:rotate-0 transition-all duration-500 overflow-hidden">
                        <span id="level-badge" class="text-2xl font-bold text-white font-system transform -rotate-45 group-hover:rotate-0 transition-all duration-500">1</span>
                    </div>
                    <div class="absolute -bottom-6 w-full text-center text-[10px] text-blue-500 font-mono tracking-widest mt-2">LEVEL</div>
                </div>
                
                <div class="flex-1 md:w-80">
                    <div class="flex justify-between text-[10px] text-blue-400 mb-1 font-mono tracking-widest uppercase">
                        <span>Experience</span>
                        <span id="xp-text">0 / 150</span>
                    </div>
                    <div class="w-full bg-[#111] h-2 overflow-hidden border border-[#333]">
                        <div id="xp-bar" class="system-progress h-full transition-all duration-700" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <div class="text-right">
                    <div class="text-[10px] text-amber-600 font-mono tracking-widest uppercase">Gold</div>
                    <div class="flex items-center justify-end gap-2">
                        <span id="gold-text" class="font-bold text-amber-400 font-mono text-xl" style="text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);">0</span>
                        <i class="fa-solid fa-coins text-amber-500 text-xs"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- SCROLLABLE AREA -->
        <div class="flex-1 overflow-y-auto p-4 md:p-10 relative" id="content-area">
            <!-- Background Grid Effect -->
            <div class="fixed inset-0 opacity-5 pointer-events-none z-0" 
                 style="background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px); background-size: 40px 40px;">
            </div>

            <!-- TAB: QUESTS -->
            <div id="tab-quests" class="max-w-6xl mx-auto relative z-10 animate-fade-in">
                <div class="flex justify-between items-center mb-8 border-b border-[#222] pb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-white font-system tracking-wide mb-1">QUEST LOG</h2>
                        <p class="text-xs text-slate-500 font-mono">Current Missions & Objectives</p>
                    </div>
                    <button onclick="openModal('quest-modal')" class="bg-blue-900/20 border border-blue-500/50 text-blue-400 hover:bg-blue-500 hover:text-black px-6 py-2 text-xs font-bold tracking-widest uppercase transition flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> New Quest
                    </button>
                </div>

                <!-- Filter Tabs -->
                <div class="flex gap-2 mb-8">
                    <button onclick="filterQuests('all')" class="filter-btn active px-4 py-1 text-xs font-mono uppercase tracking-widest border border-blue-500 text-blue-400 bg-blue-900/20">All</button>
                    <button onclick="filterQuests('daily')" class="filter-btn px-4 py-1 text-xs font-mono uppercase tracking-widest border border-[#333] text-slate-500 hover:border-slate-500 transition">Daily</button>
                    <button onclick="filterQuests('main')" class="filter-btn px-4 py-1 text-xs font-mono uppercase tracking-widest border border-[#333] text-slate-500 hover:border-slate-500 transition">Story</button>
                    <button onclick="filterQuests('side')" class="filter-btn px-4 py-1 text-xs font-mono uppercase tracking-widest border border-[#333] text-slate-500 hover:border-slate-500 transition">Side</button>
                </div>

                <!-- Quest Grid -->
                <div id="quest-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Quests injected here -->
                </div>
            </div>

            <!-- TAB: SHOP -->
            <div id="tab-shop" class="hidden max-w-5xl mx-auto relative z-10">
                <div class="mb-8 border-b border-[#222] pb-4">
                    <h2 class="text-2xl font-bold text-white font-system tracking-wide mb-1">ITEM STORE</h2>
                    <p class="text-xs text-slate-500 font-mono">Exchange Gold for Rewards</p>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Add Reward Card -->
                    <div class="border border-dashed border-[#333] bg-transparent p-6 flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-blue-900/10 transition group h-48" onclick="openModal('shop-modal')">
                        <i class="fa-solid fa-plus text-2xl text-[#333] group-hover:text-blue-500 mb-2 transition"></i>
                        <span class="text-xs font-mono uppercase tracking-widest text-slate-500 group-hover:text-blue-400">Add Item</span>
                    </div>

                    <!-- Dynamic Shop Items -->
                    <div id="shop-list" class="contents"></div>
                </div>
            </div>

            <!-- TAB: PROFILE -->
            <div id="tab-profile" class="hidden max-w-4xl mx-auto relative z-10">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Character Card -->
                    <div class="md:col-span-1 bg-[#0a0a0a] border border-[#333] p-1 flex flex-col">
                        <!-- CLICKABLE AVATAR AREA -->
                        <div onclick="triggerAvatarUpload()" class="avatar-container cursor-pointer bg-[#111] flex-1 flex items-center justify-center min-h-[350px] border border-[#222] relative overflow-hidden group">
                            
                            <!-- Default / Uploaded Image -->
                            <div id="profile-image-display" class="w-full h-full absolute inset-0 bg-cover bg-center z-0" style="display:none;"></div>
                            <i id="profile-default-icon" class="fa-solid fa-user-secret text-8xl text-[#333] transition duration-700 z-0 relative"></i>
                            
                            <!-- Overlay Effect -->
                            <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-90 z-10 pointer-events-none"></div>
                            
                            <!-- Upload Hint Overlay -->
                            <div class="avatar-overlay absolute inset-0 z-20 flex items-center justify-center flex-col text-blue-400">
                                <i class="fa-solid fa-camera text-3xl mb-2"></i>
                                <span class="text-xs font-mono uppercase tracking-widest">Change Avatar</span>
                            </div>
                            
                            <div class="absolute bottom-4 left-4 z-30 pointer-events-none">
                                <h2 class="text-xl font-bold text-white font-system tracking-wider">PLAYER ONE</h2>
                                <p class="text-xs text-blue-500 font-mono">CLASS: STUDENT (MAGE)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Panel -->
                    <div class="md:col-span-2 space-y-6">
                        <div class="bg-[#0a0a0a] border border-[#333] p-6 relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                            <h3 class="text-lg font-bold text-white font-system mb-6 flex justify-between">
                                <span>STATUS</span>
                                <span class="text-xs font-mono text-slate-500 self-center">EVALUATION: E-RANK</span>
                            </h3>

                            <div class="grid grid-cols-2 gap-y-6 gap-x-12">
                                <div>
                                    <p class="text-[10px] text-slate-500 font-mono uppercase mb-1">Level</p>
                                    <p class="text-2xl font-mono text-white" id="profile-level">1</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-slate-500 font-mono uppercase mb-1">Job</p>
                                    <p class="text-lg font-mono text-white">Informatics Student</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-slate-500 font-mono uppercase mb-1">Quests Cleared</p>
                                    <p class="text-xl font-mono text-blue-400" id="profile-completed">0</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-slate-500 font-mono uppercase mb-1">Total XP</p>
                                    <p class="text-xl font-mono text-blue-400" id="profile-total-xp">0</p>
                                </div>
                            </div>

                            <div class="mt-8 pt-6 border-t border-[#222]">
                                <p class="text-[10px] text-slate-500 font-mono uppercase mb-2">Intelligence (Level Multiplier)</p>
                                <div class="flex items-center gap-4">
                                    <div class="flex-1 bg-[#111] h-1">
                                        <div class="bg-purple-500 h-full w-3/4 shadow-[0_0_10px_rgba(168,85,247,0.5)]"></div>
                                    </div>
                                    <span class="text-xs font-mono text-purple-400">1.5x</span>
                                </div>
                            </div>
                        </div>
                    </div>
                 </div>
            </div>

             <!-- TAB: SETTINGS -->
             <div id="tab-settings" class="hidden max-w-3xl mx-auto relative z-10">
                <div class="border border-[#333] bg-[#0a0a0a] p-8 relative">
                    <div class="absolute top-0 right-0 p-2 text-[#333]">
                        <i class="fa-solid fa-gear text-4xl opacity-20"></i>
                    </div>
                    <h2 class="text-xl font-bold text-white font-system mb-6">SYSTEM CONFIGURATION</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="exportData()" class="border border-emerald-900 bg-emerald-900/10 hover:bg-emerald-900/30 text-emerald-500 p-4 text-left transition group">
                            <p class="text-xs font-mono uppercase mb-1">Backup</p>
                            <h3 class="font-bold group-hover:translate-x-1 transition-transform">EXPORT DATA <i class="fa-solid fa-download ml-2 text-xs"></i></h3>
                        </button>

                        <div class="relative">
                            <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this)">
                            <button onclick="document.getElementById('import-file').click()" class="w-full h-full border border-blue-900 bg-blue-900/10 hover:bg-blue-900/30 text-blue-500 p-4 text-left transition group">
                                <p class="text-xs font-mono uppercase mb-1">Restore</p>
                                <h3 class="font-bold group-hover:translate-x-1 transition-transform">IMPORT DATA <i class="fa-solid fa-upload ml-2 text-xs"></i></h3>
                            </button>
                        </div>
                    </div>

                    <div class="mt-12 border-t border-[#222] pt-6">
                        <button onclick="hardReset()" class="text-red-500 hover:text-red-400 text-xs font-mono uppercase tracking-widest hover:underline">
                            [WARNING] FACTORY RESET SYSTEM
                        </button>
                    </div>
                </div>
           </div>

        </div>
    </main>

    <!-- ADD QUEST MODAL -->
    <div id="quest-modal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-[#0a0a0a] border border-blue-500/30 w-full max-w-md shadow-[0_0_50px_rgba(0,0,0,0.8)] relative">
            <div class="bg-blue-900/20 border-b border-blue-500/30 p-4 flex justify-between items-center">
                <h3 class="text-sm font-bold text-blue-400 font-mono tracking-widest uppercase">New Quest Objective</h3>
                <button onclick="closeModal('quest-modal')" class="text-blue-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-5">
                <div>
                    <label class="block text-[10px] font-mono text-slate-500 uppercase mb-1">Quest Name</label>
                    <input type="text" id="q-title" class="w-full bg-black border border-[#333] p-3 text-white text-sm focus:border-blue-500 focus:outline-none font-mono" placeholder="Enter objective...">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-mono text-slate-500 uppercase mb-1">Category</label>
                        <select id="q-type" class="w-full bg-black border border-[#333] p-3 text-white text-xs focus:border-blue-500 focus:outline-none font-mono uppercase">
                            <option value="daily">Daily</option>
                            <option value="main">Story</option>
                            <option value="side">Side</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-mono text-slate-500 uppercase mb-1">Difficulty Rank</label>
                        <select id="q-tier" class="w-full bg-black border border-[#333] p-3 text-white text-xs focus:border-blue-500 focus:outline-none font-mono uppercase" onchange="updateEstimates()">
                            <option value="C">E-Rank (Easy)</option>
                            <option value="B">C-Rank (Medium)</option>
                            <option value="A">A-Rank (Hard)</option>
                            <option value="S">S-Rank (Hell)</option>
                        </select>
                    </div>
                </div>

                <div class="bg-[#111] p-3 border-l-2 border-blue-500 flex justify-between items-center">
                    <span class="text-[10px] text-slate-400 font-mono uppercase">Reward Preview</span>
                    <span class="text-blue-400 font-mono text-xs" id="est-reward">20 XP | 5 Gold</span>
                </div>

                <button onclick="addQuest()" class="w-full bg-blue-600 hover:bg-blue-500 text-black font-bold py-3 text-sm uppercase tracking-widest transition hover:shadow-[0_0_15px_rgba(37,99,235,0.5)]">
                    Initiate Quest
                </button>
            </div>
        </div>
    </div>

    <!-- ADD SHOP ITEM MODAL -->
    <div id="shop-modal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-[#0a0a0a] border border-[#333] w-full max-w-md relative">
            <div class="bg-[#111] border-b border-[#333] p-4 flex justify-between items-center">
                <h3 class="text-sm font-bold text-white font-mono tracking-widest uppercase">Register Item</h3>
                <button onclick="closeModal('shop-modal')" class="text-slate-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-6 space-y-5">
                <div>
                    <label class="block text-[10px] font-mono text-slate-500 uppercase mb-1">Item Name</label>
                    <input type="text" id="s-title" class="w-full bg-black border border-[#333] p-3 text-white text-sm focus:border-amber-500 focus:outline-none font-mono" placeholder="e.g. Potion (Coffee)...">
                </div>
                <div>
                    <label class="block text-[10px] font-mono text-slate-500 uppercase mb-1">Cost (Gold)</label>
                    <input type="number" id="s-cost" class="w-full bg-black border border-[#333] p-3 text-white text-sm focus:border-amber-500 focus:outline-none font-mono" placeholder="0">
                </div>
                <button onclick="addShopItem()" class="w-full bg-amber-700 hover:bg-amber-600 text-white font-bold py-3 text-sm uppercase tracking-widest transition">
                    Confirm Registration
                </button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed bottom-10 right-10 bg-black border border-blue-500 shadow-[0_0_20px_rgba(0,234,255,0.3)] text-white px-6 py-4 transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-4">
        <div class="text-blue-500 animate-pulse">
            <i class="fa-solid fa-circle-info"></i>
        </div>
        <div>
            <h4 class="font-bold text-sm font-system tracking-wider text-blue-400">QUEST COMPLETED</h4>
            <p class="text-xs font-mono text-white" id="toast-msg">+50 XP</p>
        </div>
    </div>

    <!-- LEVEL UP OVERLAY -->
    <div id="lvl-up-overlay" class="fixed inset-0 bg-black/95 z-[60] hidden flex-col items-center justify-center text-center p-4">
        <div class="border-y-2 border-blue-500 py-12 w-full max-w-2xl bg-blue-900/10 backdrop-blur relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-blue-400 shadow-[0_0_20px_#60a5fa]"></div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-blue-400 shadow-[0_0_20px_#60a5fa]"></div>
            
            <h1 class="text-5xl md:text-7xl font-black text-white font-system mb-4 tracking-widest animate-pulse" style="text-shadow: 0 0 20px rgba(59, 130, 246, 0.8);">LEVEL UP!</h1>
            
            <div class="flex justify-center items-center gap-4 text-2xl font-mono text-blue-300 mb-8">
                <span>Current Level:</span>
                <span id="new-level-display" class="text-4xl font-bold text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.8)]">2</span>
            </div>

            <p class="text-xs text-slate-400 font-mono tracking-[0.3em] uppercase mb-12">All stats have been recovered.</p>

            <button onclick="closeLevelUp()" class="border border-blue-500 text-blue-400 hover:bg-blue-500 hover:text-black font-bold px-12 py-3 font-mono uppercase tracking-widest transition">
                Confirm
            </button>
        </div>
    </div>

    <script>
        // --- CONFIGURATION & CONSTANTS (SOLO LEVELING EDITION) ---
        const TIERS = {
            'C': { xp: 20, gold: 5, color: 'tier-c', label: 'E-Rank' }, // Basic
            'B': { xp: 60, gold: 15, color: 'tier-b', label: 'C-Rank' }, // Medium
            'A': { xp: 150, gold: 40, color: 'tier-a', label: 'A-Rank' }, // Hard
            'S': { xp: 500, gold: 150, color: 'tier-s', label: 'S-Rank' } // Boss/Epic
        };

        // --- STATE MANAGEMENT ---
        let state = {
            level: 1,
            currentXp: 0,
            neededXp: 150,
            hp: 100,
            maxHp: 100,
            gold: 0,
            totalXpEarned: 0,
            questsCompleted: 0,
            avatar: null, // New field for storing base64 image
            quests: [],
            shop: [
                { id: 1, title: 'Potion (Coffee)', cost: 50 },
                { id: 2, title: 'Elixir (Snack)', cost: 100 },
                { id: 3, title: 'Dungeon Break (Day Off)', cost: 500 }
            ]
        };

        // --- INITIALIZATION ---
        function init() {
            loadData();
            checkDailyReset();
            renderUI();
            
            if (state.quests.length === 0) {
                state.quests = [
                    { id: Date.now(), title: 'Daily Training: Push-ups', type: 'daily', tier: 'C', completed: false, lastCompleted: null },
                    { id: Date.now() + 1, title: 'Study Algorithm', type: 'daily', tier: 'B', completed: false, lastCompleted: null },
                    { id: Date.now() + 2, title: 'Clear Final Exam', type: 'main', tier: 'S', completed: false, lastCompleted: null }
                ];
                saveData();
                renderUI();
            }
        }

        // --- AVATAR HANDLING ---
        function triggerAvatarUpload() {
            document.getElementById('avatar-upload').click();
        }

        function handleAvatarUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // Check file size (Limit to 2MB to prevent LS storage issues)
            if (file.size > 2 * 1024 * 1024) {
                alert("SYSTEM WARNING: IMAGE TOO LARGE (MAX 2MB)");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                // Simple Image Compression via Canvas
                const img = new Image();
                img.src = e.target.result;
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Resize to max 400px width/height
                    const maxSize = 400;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height) {
                        if (width > maxSize) {
                            height *= maxSize / width;
                            width = maxSize;
                        }
                    } else {
                        if (height > maxSize) {
                            width *= maxSize / height;
                            height = maxSize;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Save as JPEG with 0.7 quality
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                    state.avatar = compressedBase64;
                    saveData();
                    renderProfile();
                    showToast("AVATAR UPDATED");
                }
            };
            reader.readAsDataURL(file);
        }

        // --- LOGIC ---
        function getNextLevelXp(lvl) {
            return Math.floor(lvl * 100 * 1.5);
        }

        function addXp(amount) {
            state.currentXp += amount;
            state.totalXpEarned += amount;
            if (state.currentXp >= state.neededXp) {
                levelUp();
            } else {
                updateHeaderStats();
                saveData();
            }
        }

        function levelUp() {
            state.currentXp -= state.neededXp;
            state.level++;
            state.neededXp = getNextLevelXp(state.level);
            state.hp = state.maxHp;
            
            if (state.currentXp >= state.neededXp) {
                levelUp();
            } else {
                saveData();
                renderUI();
                showLevelUpOverlay();
            }
        }

        function takeDamage() {
            state.hp -= 10;
            if (state.hp <= 0) {
                state.hp = 0;
                alert("SYSTEM ALERT: PLAYER FATIGUE CRITICAL. REST REQUIRED.");
            }
            document.body.classList.add('damage-anim');
            setTimeout(() => document.body.classList.remove('damage-anim'), 500);
            updateHeaderStats();
            saveData();
        }

        function completeQuest(id) {
            const questIndex = state.quests.findIndex(q => q.id === id);
            if (questIndex === -1) return;
            
            const quest = state.quests[questIndex];
            const reward = TIERS[quest.tier];

            if (quest.type === 'daily') {
                quest.completed = true;
                quest.lastCompleted = new Date().toDateString();
            } else {
                state.quests.splice(questIndex, 1);
            }

            state.gold += reward.gold;
            state.questsCompleted++;
            
            showToast(`OBTAINED: ${reward.xp} XP | ${reward.gold} GOLD`);
            addXp(reward.xp);
            renderQuests();
        }

        function addQuest() {
            const title = document.getElementById('q-title').value;
            const type = document.getElementById('q-type').value;
            const tier = document.getElementById('q-tier').value;

            if (!title) return;

            state.quests.push({
                id: Date.now(),
                title,
                type,
                tier,
                completed: false,
                lastCompleted: null
            });

            saveData();
            renderQuests();
            closeModal('quest-modal');
            document.getElementById('q-title').value = "";
        }

        function deleteQuest(id, event) {
            event.stopPropagation();
            if(!confirm("Abort this quest?")) return;
            state.quests = state.quests.filter(q => q.id !== id);
            saveData();
            renderQuests();
        }

        function buyItem(id) {
            const item = state.shop.find(i => i.id === id);
            if (state.gold >= item.cost) {
                if(confirm(`Purchase [${item.title}] for ${item.cost} G?`)) {
                    state.gold -= item.cost;
                    showToast(`ITEM ACQUIRED: ${item.title}`);
                    updateHeaderStats();
                    saveData();
                }
            } else {
                alert("SYSTEM: INSUFFICIENT GOLD.");
            }
        }

        function addShopItem() {
            const title = document.getElementById('s-title').value;
            const cost = parseInt(document.getElementById('s-cost').value);
            if (!title || !cost) return;
            state.shop.push({ id: Date.now(), title, cost });
            saveData();
            renderShop();
            closeModal('shop-modal');
            document.getElementById('s-title').value = "";
            document.getElementById('s-cost').value = "";
        }

        function deleteShopItem(id, event) {
            event.stopPropagation();
            state.shop = state.shop.filter(i => i.id !== id);
            saveData();
            renderShop();
        }

        // --- UI RENDERERS ---
        function renderUI() {
            updateHeaderStats();
            renderQuests();
            renderShop();
            renderProfile();
        }

        function updateHeaderStats() {
            const xpPercent = (state.currentXp / state.neededXp) * 100;
            document.getElementById('xp-bar').style.width = `${xpPercent}%`;
            document.getElementById('xp-text').innerText = `${state.currentXp} / ${state.neededXp}`;
            document.getElementById('level-badge').innerText = state.level;
            
            const hpPercent = (state.hp / state.maxHp) * 100;
            document.getElementById('hp-bar').style.width = `${hpPercent}%`;
            document.getElementById('hp-text').innerText = `${state.hp}/${state.maxHp}`;
            document.getElementById('gold-text').innerText = state.gold;
        }

        let currentFilter = 'all';
        function filterQuests(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-400', 'bg-blue-900/20');
                btn.classList.add('border-[#333]', 'text-slate-500');
            });
            
            const buttons = document.querySelectorAll('.filter-btn');
            let activeIndex = type === 'all' ? 0 : type === 'daily' ? 1 : type === 'main' ? 2 : 3;
            buttons[activeIndex].classList.remove('border-[#333]', 'text-slate-500');
            buttons[activeIndex].classList.add('border-blue-500', 'text-blue-400', 'bg-blue-900/20');

            renderQuests();
        }

        function renderQuests() {
            const list = document.getElementById('quest-list');
            list.innerHTML = '';

            let filtered = state.quests;
            if (currentFilter !== 'all') {
                filtered = state.quests.filter(q => q.type === currentFilter);
            }

            const tierValue = { 'S': 4, 'A': 3, 'B': 2, 'C': 1 };
            filtered.sort((a, b) => {
                if (a.completed === b.completed) return tierValue[b.tier] - tierValue[a.tier];
                return a.completed ? 1 : -1;
            });

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="text-slate-600 text-center col-span-full py-12 border border-dashed border-[#333] bg-[#0a0a0a]/50">
                        <p class="font-mono text-xs uppercase tracking-widest">No Active Quests in Sector</p>
                    </div>
                `;
                return;
            }

            filtered.forEach(q => {
                const tierInfo = TIERS[q.tier];
                const isDone = q.completed;
                
                const card = document.createElement('div');
                card.className = `quest-card p-5 ${tierInfo.color} ${isDone ? 'opacity-30 grayscale' : ''}`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <span class="px-2 py-0.5 text-[9px] font-mono font-bold uppercase tracking-widest bg-[#111] text-slate-400 border border-[#333]">${q.type}</span>
                        <button onclick="deleteQuest(${q.id}, event)" class="text-[#333] hover:text-red-500 transition"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <h3 class="font-bold text-white mb-1 font-system tracking-wide text-sm">${q.title}</h3>
                    <div class="flex items-center gap-4 text-[10px] mt-4 font-mono text-slate-400 uppercase">
                        <span><i class="fa-solid fa-bolt text-blue-500 mr-1"></i> ${tierInfo.xp} XP</span>
                        <span><i class="fa-solid fa-coins text-amber-500 mr-1"></i> ${tierInfo.gold} G</span>
                    </div>
                    ${!isDone ? `
                    <button onclick="completeQuest(${q.id})" class="mt-5 w-full border border-blue-500/30 hover:bg-blue-500 hover:text-black text-blue-400 py-2 text-xs font-bold uppercase tracking-widest transition flex items-center justify-center gap-2 group">
                        <span>COMPLETE</span> <i class="fa-solid fa-chevron-right text-[10px] group-hover:translate-x-1 transition-transform"></i>
                    </button>` 
                    : `
                    <div class="mt-5 w-full bg-[#111] text-green-500 py-2 text-xs font-bold uppercase tracking-widest text-center border border-green-900/30">
                        CLEARED
                    </div>
                    `}
                `;
                list.appendChild(card);
            });
        }

        function renderShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = '';

            state.shop.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-[#0a0a0a] border border-[#333] p-5 flex flex-col justify-between hover:border-amber-500/50 transition relative group h-48";
                card.innerHTML = `
                    <button onclick="deleteShopItem(${item.id}, event)" class="absolute top-3 right-3 text-[#333] hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-xmark"></i></button>
                    <div>
                        <h3 class="font-bold text-white text-sm font-system tracking-wide mb-1">${item.title}</h3>
                        <p class="text-slate-500 text-[10px] font-mono uppercase">Consumable Item</p>
                    </div>
                    <button onclick="buyItem(${item.id})" class="w-full border border-amber-600/30 text-amber-500 hover:bg-amber-600 hover:text-black py-2 text-xs font-bold font-mono transition flex items-center justify-center gap-2">
                        <span>${item.cost} G</span>
                    </button>
                `;
                list.appendChild(card);
            });
        }

        function renderProfile() {
            document.getElementById('profile-level').innerText = state.level;
            document.getElementById('profile-total-xp').innerText = state.totalXpEarned;
            document.getElementById('profile-completed').innerText = state.questsCompleted;

            // Render Avatar
            const imgDisplay = document.getElementById('profile-image-display');
            const iconDisplay = document.getElementById('profile-default-icon');

            if (state.avatar) {
                imgDisplay.style.backgroundImage = `url(${state.avatar})`;
                imgDisplay.style.display = 'block';
                iconDisplay.style.opacity = '0'; // Hide icon but keep structure
            } else {
                imgDisplay.style.display = 'none';
                iconDisplay.style.opacity = '1';
            }
        }

        // --- UTILITIES ---
        function switchTab(tabName) {
            ['quests', 'shop', 'profile', 'settings'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.add('hidden');
                document.getElementById(`nav-${t}`).classList.remove('btn-system-active');
                document.getElementById(`nav-${t}`).classList.add('text-slate-400');
            });

            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            document.getElementById(`nav-${tabName}`).classList.add('btn-system-active');
            document.getElementById(`nav-${tabName}`).classList.remove('text-slate-400');
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        
        function updateEstimates() {
            const tier = document.getElementById('q-tier').value;
            const data = TIERS[tier];
            document.getElementById('est-reward').innerText = `${data.xp} XP | ${data.gold} Gold`;
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); }, 3000);
        }

        function showLevelUpOverlay() {
            document.getElementById('new-level-display').innerText = state.level;
            document.getElementById('lvl-up-overlay').classList.remove('hidden');
            document.getElementById('lvl-up-overlay').classList.add('flex');
        }

        function closeLevelUp() {
            document.getElementById('lvl-up-overlay').classList.add('hidden');
            document.getElementById('lvl-up-overlay').classList.remove('flex');
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lifeRPG_lastDate');
            if (lastDate !== today) {
                state.quests.forEach(q => { if (q.type === 'daily') q.completed = false; });
                localStorage.setItem('lifeRPG_lastDate', today);
                saveData();
            }
        }

        // --- DATA STORAGE ---
        function saveData() { localStorage.setItem('lifeRPGData', JSON.stringify(state)); }
        function loadData() {
            const data = localStorage.getItem('lifeRPGData');
            if (data) state = JSON.parse(data);
        }
        function hardReset() {
            if(confirm("SYSTEM WARNING: DELETE ALL DATA?")) {
                localStorage.removeItem('lifeRPGData');
                location.reload();
            }
        }
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const anchor = document.createElement('a');
            anchor.setAttribute("href", dataStr);
            anchor.setAttribute("download", "player_system_data.json");
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
        }
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (json.level && json.quests) {
                        state = json;
                        saveData();
                        location.reload();
                    } else alert("INVALID SYSTEM DATA FILE.");
                } catch (err) { alert("DATA CORRUPTION DETECTED."); }
            };
            reader.readAsText(file);
        }

        init();
    </script>
</body>
</html>
